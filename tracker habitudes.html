<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔥 Tracker d'habitudes</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-center mb-6">🔥 Tracker d'habitudes</h1>

    <div id="name-section" class="mb-6">
      <input id="username" type="text" placeholder="Entre ton nom" class="w-full p-2 border rounded mb-2">
      <button onclick="saveName()" class="bg-blue-500 text-white w-full py-2 rounded">Entrer</button>
    </div>

    <div id="greeting" class="text-center text-xl font-semibold hidden mb-4"></div>

    <form id="habit-form" class="mb-4 hidden">
      <input type="text" id="habit-name" placeholder="Nouvelle habitude" required class="w-full p-2 border rounded">
      <button class="bg-indigo-500 text-white w-full py-2 mt-2 rounded">Ajouter</button>
    </form>

    <div id="habits"></div>
  </div>

  <script>
    let habits = JSON.parse(localStorage.getItem('habits') || '[]');
    let username = localStorage.getItem('username') || '';

    function saveHabits() {
      localStorage.setItem('habits', JSON.stringify(habits));
    }

    function saveName() {
      const input = document.getElementById('username');
      username = input.value.trim();
      if (username) {
        localStorage.setItem('username', username);
        document.getElementById('greeting').textContent = `Bienvenue, ${username} !`;
        document.getElementById('greeting').classList.remove('hidden');
        document.getElementById('name-section').classList.add('hidden');
        document.getElementById('habit-form').classList.remove('hidden');
        renderHabits();
      }
    }

    function renderHabits() {
      const container = document.getElementById('habits');
      container.innerHTML = '';
      habits.forEach((habit, index) => {
        const el = document.createElement('div');
        el.className = 'bg-gray-50 p-4 rounded mb-2 shadow';
        el.innerHTML = `
          <h3 class="font-semibold text-lg">${habit.name}</h3>
          <p>Série : <span class="text-orange-500 font-bold">${habit.series}</span> 🔥</p>
          <p>Gels disponibles : ${habit.freezes}</p>
          <div class="mt-2 space-x-2">
            <button onclick="markDone(${index})" class="bg-green-500 text-white px-2 py-1 rounded">✅ Fait</button>
            <button onclick="useFreeze(${index})" class="bg-blue-500 text-white px-2 py-1 rounded">🧊 Gel</button>
            <button onclick="deleteHabit(${index})" class="bg-red-500 text-white px-2 py-1 rounded">❌</button>
          </div>
        `;
        container.appendChild(el);
      });
      saveHabits();
    }

    function markDone(index) {
      habits[index].series++;
      saveHabits();
      renderHabits();
    }

    function useFreeze(index) {
      if (habits[index].freezes > 0) {
        habits[index].freezes--;
        saveHabits();
        renderHabits();
      } else {
        alert("Plus de gels disponibles !");
      }
    }

    function deleteHabit(index) {
      if (confirm("Supprimer cette habitude ?")) {
        habits.splice(index, 1);
        saveHabits();
        renderHabits();
      }
    }

    document.getElementById('habit-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('habit-name').value.trim();
      if (name) {
        habits.push({ name, series: 0, freezes: 3 });
        saveHabits();
        renderHabits();
        this.reset();
      }
    });

    // Chargement initial
    if (username) {
      document.getElementById('greeting').textContent = `Bienvenue, ${username} !`;
      document.getElementById('greeting').classList.remove('hidden');
      document.getElementById('name-section').classList.add('hidden');
      document.getElementById('habit-form').classList.remove('hidden');
      renderHabits();
    }
  </script>
</body>
</html>
